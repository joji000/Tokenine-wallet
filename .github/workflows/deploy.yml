name: Deploy to Server

on:
  push:
    branches:
      - production/githubAction

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: SSH Deploy
        uses: easingthemes/ssh-deploy@main # Updated to the latest version
        with:
          SSH_PRIVATE_KEY: ${{ secrets.SERVER_PRIVATE_KEY }} # Changed 'key' to 'SSH_PRIVATE_KEY' and using secret name as suggested
          REMOTE_HOST: ${{ secrets.SERVER_IP }} # Changed 'host' to 'REMOTE_HOST'
          REMOTE_USER: ${{ secrets.SERVER_USERNAME }} # Changed 'username' to 'REMOTE_USER'
          SOURCE: "." # Deploying the entire workspace, you can adjust SOURCE and TARGET as needed
          TARGET: "~/deployWallet" # Changed target directory to ~/deployWallet based on your script
          SCRIPT_BEFORE: "ls" # Added SCRIPT_BEFORE to force known_hosts update - workaround for "Permission denied" error
          SCRIPT_AFTER:
            | # Moved your script to SCRIPT_AFTER for better structure and clarity
            cd ~/deployWallet/wallet
            docker compose up -d --build
